{% extends "reading/reading_base.html" %}
{% load static %}
{% load core_extras %}
{% load i18n %}

{% block title %}{{ post.name }}{% endblock title %}

{% block main_section_classes %}main-content post-view-section{% endblock main_section_classes %}

{% block content %}

<div class="post-view">

<div class="post-name">
<h2>{{ post.name }}</h2>
</div>

<div class="post-content">
{{ post.content|to_html|safe }}
</div>

</div><!-- post-view -->

{% endblock content %}

{% block page_footer %}

{% if has_post_audio %}

<footer class="page-footer post-view-footer is-fixed is-bordered">

{% url 'api:nested-post-audio-list-all' post.id as post_audios_url %}

<post-audio-player
audio-player-id="post-audio"
audios-url="{{ post_audios_url }}"
:has-loop-btn="false"
:has-download-btn="false"
:has-mute-btn="false"
:has-stop-btn="false"
:has-volume-btn="false"
inline-template
>

<div v-cloak>

<audio
:id="audioPlayerId" 
:loop="loop"
preload="auto"
style="display: none;"
>
</audio>

<div 
class="audio-player dark"
v-bind:class="[{ 'is-loading': !audioLoaded }]"
>

<div 
class="audio-title"
>
<span v-if="!audioLoaded">
Loading audio
</span>
<span v-else>[[ selectedAudio.creator_username ]] - [[ selectedAudio.name ]]</span>

</div>

<div class="audio-player-controls">

<div 
class="player-control"
>
<a href="#" v-if="!audioLoaded">
<i class="fas fa-spinner fa-pulse"></i>
</a>
<a 
href="#"
title="Play/Pause"
@click.prevent="playing = !playing" 
v-else
>
<i v-if="!playing" class="fas fa-play"></i>
<i v-else class="fas fa-pause"></i>
</a>
</div>

<div class="audio-progress-container">

<div class="audio-progress">

<div 
class="seek-bar"
ref="audioPlayerSeekBar"
@mousedown="onProgressMousedown"
>

<div 
class="play-bar"
:style="{ width: this.percentComplete + '%' }"
>

<div class="bullet"></div>

</div><!-- play-bar -->

</div><!-- seek-bar -->

</div><!-- progress -->

<div class="audio-player-time">

<div class="audio-player-time-current">[[ currentTime ]]</div>
<div class="audio-player-time-total">[[ durationTime ]]</div>

</div><!-- audio-player-time -->

</div><!-- progress-container -->

</div><!-- audio-player-controls -->

</div><!-- audio-player -->

</div>
</post-audio-player>

</footer>

{% endif %}

{% endblock page_footer %}